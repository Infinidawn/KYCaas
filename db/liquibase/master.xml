<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.15.xsd">

  <changeSet id="0001-core-tables" author="bot">
    <createTable tableName="tenant">
      <column name="id" type="UUID" constraints="primaryKey:true"/>
      <column name="name" type="VARCHAR(120)"/>
      <column name="plan" type="VARCHAR(40)"/>
    </createTable>

    <createTable tableName="kyc_session">
      <column name="id" type="UUID" constraints="primaryKey:true"/>
      <column name="tenant_id" type="UUID"/>
      <column name="channel" type="VARCHAR(20)"/>
      <column name="phone" type="VARCHAR(40)"/>
      <column name="state" type="VARCHAR(20)"/>
      <column name="created_at" type="TIMESTAMP WITH TIME ZONE" defaultValueComputed="CURRENT_TIMESTAMP"/>
      <column name="decided_at" type="TIMESTAMP WITH TIME ZONE"/>
    </createTable>

    <createTable tableName="document_result">
      <column name="id" type="UUID" constraints="primaryKey:true"/>
      <column name="tenant_id" type="UUID"/>
      <column name="session_id" type="UUID"/>
      <column name="id_type" type="VARCHAR(30)"/>
      <column name="id_number" type="VARCHAR(60)"/>
      <column name="front_image_url" type="TEXT"/>
      <column name="created_at" type="TIMESTAMP WITH TIME ZONE" defaultValueComputed="CURRENT_TIMESTAMP"/>
    </createTable>

    <createTable tableName="biometric_result">
      <column name="id" type="UUID" constraints="primaryKey:true"/>
      <column name="tenant_id" type="UUID"/>
      <column name="session_id" type="UUID"/>
      <column name="selfie_image_url" type="TEXT"/>
      <column name="created_at" type="TIMESTAMP WITH TIME ZONE" defaultValueComputed="CURRENT_TIMESTAMP"/>
    </createTable>

    <createTable tableName="risk_decision">
      <column name="session_id" type="UUID" constraints="primaryKey:true"/>
      <column name="tenant_id" type="UUID"/>
      <column name="status" type="VARCHAR(20)"/>
      <column name="reasons" type="TEXT"/>
      <column name="created_at" type="TIMESTAMP WITH TIME ZONE" defaultValueComputed="CURRENT_TIMESTAMP"/>
    </createTable>
  </changeSet>

  <changeSet id="0002-seed-tenant" author="bot">
    <insert tableName="tenant">
      <column name="id" value="11111111-1111-1111-1111-111111111111"/>
      <column name="name" value="Demo Tenant"/>
      <column name="plan" value="dev"/>
    </insert>
  </changeSet>
</databaseChangeLog>
